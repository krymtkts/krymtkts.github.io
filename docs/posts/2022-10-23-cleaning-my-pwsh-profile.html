<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>krymtkts: PowerShell の My Profile を掃除する</title>
    <link rel="canonical" href="https://krymtkts.github.io/posts/2022-10-23-cleaning-my-pwsh-profile">
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
    <meta name="description" content="krymtkts&#39;s personal blog">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="krymtkts&#39;s personal blog" />
    <meta property="og:site_name" content="krymtkts" />
    <meta property="og:title" content="krymtkts: PowerShell の My Profile を掃除する" />
    <meta property="og:url" content="https://krymtkts.github.io/posts/2022-10-23-cleaning-my-pwsh-profile" />
    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.0/css/bootstrap.min.css" integrity="sha512-XWTTruHZEYJsxV3W/lSXG1n3Q39YIWOstqvmFsdNEEQfHoZ6vm6E9GK2OrF6DSJSpIbRbi+Nn0WDPID9O7xB2Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/fontawesome.min.css" integrity="sha512-R+xPS2VPCAFvLRy+I4PgbwkWjw1z5B5gNDYgJN5LfzV4gGNeRQyVrY7Uk59rX+c8tzz63j8DeZPLqmXvBxj8pA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/base16/solarized-dark.min.css" integrity="sha512-kBHeOXtsKtA97/1O3ebZzWRIwiWEOmdrylPrOo3D2+pGhq1m+1CroSOVErIlsqn1xmYowKfQNVDhsczIzeLpmg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-expand-lg navbar-default">
    <div class="container">
        <div class="navbar-header d-flex w-100 justify-content-between">
            <a class="navbar-brand" href="/">krymtkts</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a  class="nav-link "  href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a  class="nav-link "  href="/archives">Archives</a>
                </li>
                
                <li class="nav-item">
                    <a  class="nav-link "  href="/pages/about">About Me</a>
                </li>
                
                <li class="nav-item"><a class="nav-link" href="/feed.xml">RSS</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" id="dropdown-menu-link" data-bs-toggle="dropdown" aria-expanded="false">
                        More <span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-menu-link">
                        

                        
                        <li class="dropdown-header">Recent Posts</li>
                        
                        <li><a class="dropdown-item" href="/posts/2023-07-09-migrate-dev-environment">開発環境をプチ移行する</a></li>
                        
                        <li><a class="dropdown-item" href="/posts/2023-07-02-rebuild-blog-with-fable-pt9">Fable でブログを再構築する pt.9</a></li>
                        
                        <li><a class="dropdown-item" href="/posts/2023-06-25-rebuild-blog-with-fable-pt8">Fable でブログを再構築する pt.8</a></li>
                        
                        

                        
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-header">Tags</li>
                        
                        <li><a class="dropdown-item" href="/tags/biasamp">biasamp</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/poco">poco</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/windows-terminal">windows-terminal</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/tips">tips</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/evernote">evernote</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/qunit">qunit</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/cryogen">cryogen</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/mouse">mouse</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/nyc">nyc</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/ouraring">ouraring</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/diary">diary</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/github">github</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/clojure">clojure</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/vscode">vscode</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/stepfunctions">stepfunctions</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/aws">aws</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/shieldsio">shieldsio</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/retrospective">retrospective</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/boto3">boto3</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/job">job</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/oh-my-posh">oh-my-posh</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/elm">elm</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/elb">elb</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/openssh">openssh</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/electron">electron</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/powershell">powershell</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/gist">gist</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/planck">planck</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/acm">acm</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/fable">fable</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/php">php</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/go">go</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/mechanicalkeyboard">mechanicalkeyboard</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/pandoc">pandoc</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/fsharp">fsharp</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/cvs2git">cvs2git</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/windows">windows</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/maven">maven</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/font">font</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/git">git</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/docker">docker</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/todo">todo</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/sh">sh</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/cement">cement</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/psake">psake</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/textlin">textlin</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/python">python</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/golang">golang</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/fnm">fnm</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/lambda">lambda</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/tortoisegit">tortoisegit</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/docker-toolbox">docker-toolbox</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/serverless">serverless</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/qmkfirmware">qmkfirmware</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/razer">razer</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/nodejs">nodejs</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/goal">goal</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/powershellgallery">powershellgallery</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/puppeteer">puppeteer</a></li>
                        
                        
                    </ul>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">2022-10-23</div>
        
    </div>
    <h2>PowerShell の My Profile を掃除する</h2>
</div>
<div>
    
    <p>PowerShell の profile を Gist で管理してるのだけど、この度掃除をした。</p><p><a href="https://gist.github.com/krymtkts/f8af667c32b16fc28a815243b316c5be">My PowerShell profile.</a></p><p>片手間にできる範囲しかやらなかったので、使ってないモジュールと関数の取り除きが主。あとは順番をちょっと入れ替えてみたり、把握してなかった全貌を眺めてみた。</p><p>これらの取り除きついでに、供養がてら何のためにつかってたのかとか振り返ってみる。</p><h3 id="モジュール取り除き">モジュール取り除き</h3><p><a href="https://github.com/mklement0/ClipboardText">mklement0/ClipboardText: Universal clipboard text support for PowerShell, notably also in PowerShell Core (cross-platform) and Windows PowerShell v2-v4</a></p><p><a href="https://www.powershellgallery.com/packages/ClipboardText/0.1.8">ClipboardText</a> というモジュール。コレなんで使ってたのかすら忘れてしまったけど、結構使ってた記憶がある。
<code>Set-ClipboardText</code> <code>Get-ClipboardText</code> が使えるようになる。
PowerShell Core を使い始めた頃はクリップボード操作の Cmdlet がなくてできなかったとかそんな理由だったか？</p><p>今やフツーに <code>Set-Clipboard</code> <code>Get-Clipboard</code> 使ってるので不要になったけどずっと消してなかった。今までありがとう、消した。</p><p><a href="https://www.powershellgallery.com/packages/poco/1.1.0">poco</a>も残ってるかな？と思ったが、そうでもなかった。
(変え漏れを除けば)意外にも <a href="https://www.powershellgallery.com/packages/pocof/0.2.0-alpha">pocof</a> への変更は忘れてなかったらしい。</p><p>あとモジュールは跡形もなかったが、昔 <a href="https://www.powershellgallery.com/packages/GoogleCloud/1.0.1.10">GoogleCloud</a> を使って勉強してたときの名残があったのでそれも消した。
このモジュールもう 4 年くらいメンテされてない様子、残念やけど多分重要でないんだろうな。</p><h3 id="関数取り除き">関数取り除き</h3><h4 id="明らかな消し忘れ-virtualbox-関連">明らかな消し忘れ。 VirtualBox 関連</h4><pre><code class="powershell">function Start-VBoxMachine() {
    vboxmanage list vms | Select-Pocof -CaseSensitive | Out-String -Stream | Select-String -Pattern '\{(.+)\}' | ForEach-Object { vboxmanage startvm ($_.Matches[0].Groups['1'].Value) --type headless }
}

function Stop-VBoxMachine() {
    vboxmanage list runningvms | Select-Pocof -CaseSensitive | Out-String -Stream | Select-String -Pattern '\{(.+)\}' | ForEach-Object { vboxmanage controlvm ($_.Matches[0].Groups['1'].Value) poweroff }
}

function Get-RunningVBoxMachines() {
    vboxmanage list runningvms
}
</code></pre><p>こんなのがあった。VirtualBox の GUI を介さずに VM の起動・停止をするための奴らだったか確か。
前々職でコンテナ移行しきれてない秘伝の開発環境 VM がチラホラあって、それで使ってた記憶がある。あの VM ちゃん達は今も元気に VM してるのだろうか。
もはや使うこともないので消す。でも供養がてら Gist に残しておいた。</p><p><a href="https://gist.github.com/krymtkts/47f70697cbe006e81d7fd801e1e3b351">krymtkts/scripts-for-virtualbox.ps1</a></p><h4 id="なんだコレ-find-ぽいやつ">なんだコレ。 <code>find</code> ぽい？やつ</h4><pre><code class="powershell">function find {
    [CmdletBinding()]
    param(
        [string]$path = '.',
        [Parameter(Mandatory = $True,
            ValueFromPipeline = $True)]
        [string[]]$name,
        [switch]$delete
    )

    begin {
    }

    process {
        foreach ($n in $Name) {
            if ($delete) {
                Get-ChildItem -Recurse -Path $path | Where-Object -Property Name -Like $n | Remove-Item
            }
            else {
                Get-ChildItem -Recurse -Path $path | Where-Object -Property Name -Like $n
            }
        }
    }

    end {
    }
}
</code></pre><p>なんか薄っすらと、 <code>Makefile</code> から <code>find</code> 呼ぶときに何のシェルか考えるの面倒で PowerShell で <code>find</code> 作ろうとしてた覚えがあるのだけど、それをいつやってたのかわからない。いま使ってもないのでなんでここにあるのか不明。
消す。</p><h4 id="何故-profile-に足したクソデカテキストファイルを作る関数">何故 profile に足した？クソデカテキストファイルを作る関数</h4><pre><code class="powershell">function New-TextFile {
    [CmdletBinding()]
    param (
        [Parameter(Mandatory)]
        [string]
        $Name,
        [Parameter()]
        [long]
        $Byte = [Math]::Pow(1024, 3),
        [Parameter()]
        [int]
        $Basis = [Math]::Pow(1024, 2)
    )
    begin {
        if (Test-Path $Name) {
            Write-Error 'overrides currently not supported.'
            return
        }
        $Remains = $Byte % $Basis
        $Per = $Byte / $Basis
    }
    process {
        1..$Per | ForEach-Object { 'x' * $Basis | Add-Content $Name -Encoding ascii -NoNewline }
        if ($Remains -ne 0) {
            'x' * $Remains | Add-Content $Name -Encoding ascii -NoNewline
        }
    }
}
</code></pre><p>前に書いた <a href="/posts/2022-03-13-create-huge-text-file-in-pwsh">PowerShell でクソデカテキストファイルを作る</a> の関数版だと思われる。
わざわざ profile に入れておいたのはなんでだろう。スクリプトにするだけで良いのでは...過去の自分に問いたい。消した。</p><h4 id="psake-の-auto-completer-壊れてるで"><code>psake</code> の auto completer 壊れてるで...</h4><p>あと今回の掃除を通して <code>psake</code> の auto completer 壊れてるやんと言うのに気づいたので、直した。</p><p><code>Invoke-psake</code> の存在チェックをしてあったら <code>Register-ArgumentCompleter</code> するようにしてた。
けど、どっかのタイミングから <code>invoke-psake</code> が <code>invoke-cpsake</code> になってて、 auto completer が登録されなくなってた。</p><p>auto completer 周り、 <code>aws_completer</code> で <code>Register-ArgumentCompleter</code> 設定するとこも、 AWS CLI 1 の頃から使ってたのもあり AWS CLI 2 では要らなくなった部分がある(良くないけど PyPI からモジュール取ってたときの名残)。
今回は対応を先送りにした。</p><h3 id="おわり">おわり</h3><p>そこまで消すものなかったな、というのが率直な感想だが、掃除してないな～という profile だった。</p><p>コマンドの存在をチェックしてから関数とか auto completer 登録するみたいなの増えてるので、この辺共通化したいなあ。
でも共通化しだすとファイル分割もしたくなり、結局のところ今の Gist から取ってくるの終焉に向かうのでは...と思った。</p><p>なんかより良い(楽な) PowerShell の Profile 管理手段ないかなー。</p>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags/powershell">powershell</a>
    
</div>


    <div id="prev-next">
        
        <a href="/posts/2022-10-30-prepare-to-publish-psjobcanattendance">&laquo; 2022-10-30 PSJobCanAttendance の公開準備</a>
        
        
        <a class="right" href="/posts/2022-10-16-writing-cmdlet-in-fsharp-pt6">2022-10-16 F#でコマンドレットを書いてる pt.6 &raquo;</a>
        
    </div>

    


</div>

            </div>
        </div>
    </div>
    <footer>Copyright &copy; 2019-2023 krymtkts
        <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/js/bootstrap.bundle.min.js" integrity="sha512-9GacT4119eY3AcosfWtHMsT5JyZudrexyEVzTBWV3viP/YfB9e2pEy3N7WXL3SV6ASXpTU0vzzSxsbfsuUH4sQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="/js/highlight.pack.js" type="application/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>


</body>
</html>
