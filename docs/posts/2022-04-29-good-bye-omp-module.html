<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>krymtkts: さよなら oh-my-posh モジュール</title>
    <link rel="canonical" href="https://krymtkts.github.io/posts/2022-04-29-good-bye-omp-module">
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
    <meta name="description" content="krymtkts&#39;s personal blog">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="krymtkts&#39;s personal blog" />
    <meta property="og:site_name" content="krymtkts" />
    <meta property="og:title" content="krymtkts: さよなら oh-my-posh モジュール" />
    <meta property="og:url" content="https://krymtkts.github.io/posts/2022-04-29-good-bye-omp-module" />
    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.0/css/bootstrap.min.css" integrity="sha512-XWTTruHZEYJsxV3W/lSXG1n3Q39YIWOstqvmFsdNEEQfHoZ6vm6E9GK2OrF6DSJSpIbRbi+Nn0WDPID9O7xB2Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/fontawesome.min.css" integrity="sha512-R+xPS2VPCAFvLRy+I4PgbwkWjw1z5B5gNDYgJN5LfzV4gGNeRQyVrY7Uk59rX+c8tzz63j8DeZPLqmXvBxj8pA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/base16/solarized-dark.min.css" integrity="sha512-kBHeOXtsKtA97/1O3ebZzWRIwiWEOmdrylPrOo3D2+pGhq1m+1CroSOVErIlsqn1xmYowKfQNVDhsczIzeLpmg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-expand-lg navbar-default">
    <div class="container">
        <div class="navbar-header d-flex w-100 justify-content-between">
            <a class="navbar-brand" href="/">krymtkts</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a  class="nav-link "  href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a  class="nav-link "  href="/archives">Archives</a>
                </li>
                
                <li class="nav-item">
                    <a  class="nav-link "  href="/pages/about">About Me</a>
                </li>
                
                <li class="nav-item"><a class="nav-link" href="/feed.xml">RSS</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" id="dropdown-menu-link" data-bs-toggle="dropdown" aria-expanded="false">
                        More <span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-menu-link">
                        

                        
                        <li class="dropdown-header">Recent Posts</li>
                        
                        <li><a class="dropdown-item" href="/posts/2023-08-20-writing-cmdlet-in-fsharp-pt21">F# でコマンドレットを書いてる pt.21</a></li>
                        
                        <li><a class="dropdown-item" href="/posts/2023-08-13-test-publish-psresource">Publish-PSResource を試す</a></li>
                        
                        <li><a class="dropdown-item" href="/posts/2023-08-06-disassemble-and-clean-keyswitches">キースイッチを分解して掃除する</a></li>
                        
                        

                        
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-header">Tags</li>
                        
                        <li><a class="dropdown-item" href="/tags/biasamp">biasamp</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/poco">poco</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/windows-terminal">windows-terminal</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/tips">tips</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/evernote">evernote</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/qunit">qunit</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/cryogen">cryogen</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/mouse">mouse</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/nyc">nyc</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/ouraring">ouraring</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/diary">diary</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/github">github</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/clojure">clojure</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/vscode">vscode</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/stepfunctions">stepfunctions</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/aws">aws</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/shieldsio">shieldsio</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/retrospective">retrospective</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/boto3">boto3</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/job">job</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/oh-my-posh">oh-my-posh</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/elm">elm</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/elb">elb</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/openssh">openssh</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/electron">electron</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/powershell">powershell</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/gist">gist</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/planck">planck</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/acm">acm</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/fable">fable</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/php">php</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/go">go</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/mechanicalkeyboard">mechanicalkeyboard</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/pandoc">pandoc</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/fsharp">fsharp</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/cvs2git">cvs2git</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/windows">windows</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/maven">maven</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/font">font</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/git">git</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/docker">docker</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/todo">todo</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/sh">sh</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/cement">cement</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/psake">psake</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/textlin">textlin</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/python">python</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/golang">golang</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/fnm">fnm</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/lambda">lambda</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/tortoisegit">tortoisegit</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/docker-toolbox">docker-toolbox</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/serverless">serverless</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/qmkfirmware">qmkfirmware</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/razer">razer</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/nodejs">nodejs</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/goal">goal</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/powershellgallery">powershellgallery</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/puppeteer">puppeteer</a></li>
                        
                        
                    </ul>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">2022-04-29</div>
        
    </div>
    <h2>さよなら oh-my-posh モジュール</h2>
</div>
<div>
    
    <p>いつものように PowerShell Module を更新して PowerShell を立ち上げると次のようなメッセージが表示された。</p><pre><code class="txt">Hey friend

In an effort to grow oh-my-posh, the decision was made to no
longer support the PowerShell module. Over the past year, the
added benefit of the module disappeared, while the burden of
maintaining it increased.

However, this doesn't mean oh-my-posh disappears from your
terminal, it just means that you'll have to use a different
tool to install it.

All you need to do, is follow the migration guide here:

https://ohmyposh.dev/docs/migrating
</code></pre><p>あら... oh-my-posh 3 から Go で実装されて、マルチプラットフォームなプロンプトテーマエンジンになってたけど、ついにその時が来たか...という感じ。</p><p>とりあえず使えなくなる(というか更新できなくなる)と困るので、<a href="https://ohmyposh.dev/docs/migrating">移行手順</a> に記載された移行手順を行うことにした。</p><h3 id="わたしの移行手順">わたしの移行手順</h3><p>記載の順番にやってもいいけど、慎重を期すため順番を変えた。</p><p>まず <code>oh-my-posh</code> が <code>PATH</code> にある状態で、 <code>Set-PoshPrompt</code> を <code>oh-my-posh init pwsh</code> に変え、プロンプトの表示をチェックした。</p><pre><code class="powershell"># Set-PoshPrompt -Theme ~/.oh-my-posh.omp.json
oh-my-posh init pwsh --config ~/.custom.omp.json | Invoke-Expression
</code></pre><p>当然のごとくきれいに出力されるので、 PowerShell Module から置き換える。</p><p><a href="https://ohmyposh.dev/docs/installation/windows">Windows 向けの公式なインストール手順</a>では <code>winget</code>, <code>scoop</code> それか手動での更新になっている。</p><p>でもわたしは永らく <code>chocolatey</code> を使っていることもあり、有志が公開してくれているパッケージを利用する。見たところバージョンも最新に追随していていい感じ。
<a href="https://community.chocolatey.org/packages/oh-my-posh#versionhistory">Chocolatey Software | Oh-My-Posh 7.74.3</a></p><p>管理者権限で <code>cmd</code> を開き、インストールする。補足：PowerShell でもインストールできるが、PowerShell 自体を <code>chocolatey</code> でインストールしているのもあり <code>chocolatey</code> でのインストールは <code>cmd</code> で行うようにしている。</p><pre><code class="cmd">choco install oh-my-posh -y
</code></pre><p>このインストールの最後に、</p><pre><code class="plaintext">PROFILE: C:\Users\takatoshi\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1
oh-my-posh has been added to your profile. You may wish to append 'Set-PoshPrompt paradox' to set a theme
</code></pre><p>と言われたが、 Windows PowerShell のプロファイルはおろかどこにも加筆されてないようだった。</p><p>管理者権限で PowerShell を起動し、 oh-my-posh の Powershell Module を削除する。</p><pre><code class="powershell">Uninstall-Module oh-my-posh -AllVersions
</code></pre><p><code>Import-Module oh-my-posh</code> は元々書いてなかったので削除なし。代わりにプロファイルの中でインストール・更新するモジュール名を管理しているので、そこから取り除いた。</p><p>以上。</p><h3 id="感想">感想</h3><p>何事もなく移行できて良かった。</p><p>ただこれを機に、もう oh-my-posh にこだわらず、 <a href="https://starship.rs/">Starship</a> みたいなもっとイケてるプロンプトテーマエンジンに積極的に乗り換えてもいいかなーと思えてきた。</p><p>元々 oh-my-posh を使ってたのは、 2018 年頃の PowerShell でいい感じの Powerline ができる唯一のツールだったからだ(わたしの観測範囲では。もう一つその名の通り Powerline というモジュールがあったが満足の行くカスタマイズができなかった<sup id="fnref-1"><a class="footnote-ref" href="#fn-1">1</a></sup>)。
テーマを PowerShell で書けて、PowerShellGet からインストールできるのも楽だった。</p><p>とはいえ、それがマルチプラットフォームに対応した oh-my-posh の足枷になったみたいやけど。</p><p>逆に利用者の立場からいえば、 oh-my-posh が明確に PowerShell に特化しなくなったということ。
これは、わたしが Power Fighter(勝手に作った PowerShell 使いの呼び名)であるから oh-my-posh を使い続けていたという理由もなくなったことになる。</p><p>oh-my-posh が Go で書き換わったときに一番気に入らなかったのは <em><strong>設定ファイルが JSON</strong></em> なとこなので、そのフラストレーションを解消するいい機会をもらったのかも知れない。</p><div class="footnotes"><hr /><ol><li id="fn-1"><p>まだあったわ →<a href="https://www.powershellgallery.com/packages/PowerLine/3.4.0">PowerShell Gallery | PowerLine 3.4.0</a></p><a href="#fnref-1" class="footnote-backref">↩</a></li></ol></div>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags/oh-my-posh">oh-my-posh</a>
    
    <a href="/tags/powershell">powershell</a>
    
</div>


    <div id="prev-next">
        
        <a href="/posts/2022-05-07-start-to-write-cmdlet-by-fsharp">&laquo; 2022-05-07 F#で PowerShell コマンドレットを書き始めた</a>
        
        
        <a class="right" href="/posts/2022-04-23-aws-rehabilitation">2022-04-23 AWS リハビリのハマり集 &raquo;</a>
        
    </div>

    


</div>

            </div>
        </div>
    </div>
    <footer>Copyright &copy; 2019-2023 krymtkts
        <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/js/bootstrap.bundle.min.js" integrity="sha512-9GacT4119eY3AcosfWtHMsT5JyZudrexyEVzTBWV3viP/YfB9e2pEy3N7WXL3SV6ASXpTU0vzzSxsbfsuUH4sQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="/js/highlight.pack.js" type="application/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>


</body>
</html>
