<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>krymtkts: Serverless Frameworkã§AWS Lambdaã¨CloudFront</title>
    <link rel="canonical" href="https://krymtkts.github.io/posts/2019-09-01-aws-lambda-cloud-front-and-serverless">
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
    <meta name="description" content="krymtkts&#39;s personal blog">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="krymtkts&#39;s personal blog" />
    <meta property="og:site_name" content="krymtkts" />
    <meta property="og:title" content="krymtkts: Serverless Frameworkã§AWS Lambdaã¨CloudFront" />
    <meta property="og:url" content="https://krymtkts.github.io/posts/2019-09-01-aws-lambda-cloud-front-and-serverless" />
    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.0/css/bootstrap.min.css" integrity="sha512-XWTTruHZEYJsxV3W/lSXG1n3Q39YIWOstqvmFsdNEEQfHoZ6vm6E9GK2OrF6DSJSpIbRbi+Nn0WDPID9O7xB2Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/fontawesome.min.css" integrity="sha512-R+xPS2VPCAFvLRy+I4PgbwkWjw1z5B5gNDYgJN5LfzV4gGNeRQyVrY7Uk59rX+c8tzz63j8DeZPLqmXvBxj8pA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/base16/solarized-dark.min.css" integrity="sha512-kBHeOXtsKtA97/1O3ebZzWRIwiWEOmdrylPrOo3D2+pGhq1m+1CroSOVErIlsqn1xmYowKfQNVDhsczIzeLpmg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-expand-lg navbar-default">
    <div class="container">
        <div class="navbar-header d-flex w-100 justify-content-between">
            <a class="navbar-brand" href="/">krymtkts</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a  class="nav-link "  href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a  class="nav-link "  href="/archives">Archives</a>
                </li>
                
                <li class="nav-item">
                    <a  class="nav-link "  href="/pages/about">About Me</a>
                </li>
                
                <li class="nav-item"><a class="nav-link" href="/feed.xml">RSS</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" id="dropdown-menu-link" data-bs-toggle="dropdown" aria-expanded="false">
                        More <span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-menu-link">
                        

                        
                        <li class="dropdown-header">Recent Posts</li>
                        
                        <li><a class="dropdown-item" href="/posts/2023-03-12-writing-cmdlet-in-fsharp-pt15">F#ã§ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’æ›¸ã„ã¦ã‚‹ pt.15</a></li>
                        
                        <li><a class="dropdown-item" href="/posts/2023-03-05-writing-cmdlet-in-fsharp-pt14">F#ã§ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’æ›¸ã„ã¦ã‚‹ pt.14</a></li>
                        
                        <li><a class="dropdown-item" href="/posts/2023-02-26-writing-cmdlet-in-fsharp-pt13">F#ã§ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã‚’æ›¸ã„ã¦ã‚‹ pt.13</a></li>
                        
                        

                        
                        <li><hr class="dropdown-divider"></li>
                        <li class="dropdown-header">Tags</li>
                        
                        <li><a class="dropdown-item" href="/tags/biasamp">biasamp</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/poco">poco</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/windows-terminal">windows-terminal</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/tips">tips</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/evernote">evernote</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/qunit">qunit</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/cryogen">cryogen</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/mouse">mouse</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/nyc">nyc</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/ouraring">ouraring</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/diary">diary</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/github">github</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/clojure">clojure</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/vscode">vscode</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/stepfunctions">stepfunctions</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/aws">aws</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/shieldsio">shieldsio</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/retrospective">retrospective</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/boto3">boto3</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/job">job</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/oh-my-posh">oh-my-posh</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/elm">elm</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/elb">elb</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/openssh">openssh</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/electron">electron</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/powershell">powershell</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/gist">gist</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/planck">planck</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/acm">acm</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/php">php</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/go">go</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/mechanicalkeyboard">mechanicalkeyboard</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/pandoc">pandoc</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/fsharp">fsharp</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/cvs2git">cvs2git</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/windows">windows</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/maven">maven</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/font">font</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/git">git</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/docker">docker</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/todo">todo</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/sh">sh</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/cement">cement</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/psake">psake</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/textlin">textlin</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/python">python</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/golang">golang</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/fnm">fnm</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/lambda">lambda</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/tortoisegit">tortoisegit</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/docker-toolbox">docker-toolbox</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/serverless">serverless</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/qmkfirmware">qmkfirmware</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/razer">razer</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/nodejs">nodejs</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/goal">goal</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/powershellgallery">powershellgallery</a></li>
                        
                        <li><a class="dropdown-item" href="/tags/puppeteer">puppeteer</a></li>
                        
                        
                    </ul>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">2019-09-01</div>
        
    </div>
    <h2>Serverless Frameworkã§AWS Lambdaã¨CloudFront</h2>
</div>
<div>
    
    <p>AWS Lambdaã£ã¦æ›¸ãã®ã¯ãƒ›ãƒ³ãƒˆç°¡å˜ã€‚</p><p>ã§ã‚‚æ‰‹å‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã¯ã»ã‚“ã¾ã«å‹˜å¼ã—ã¦ã»ã—ã„ã‚...ã£ã¦æ„Ÿã˜ã ã£ãŸã®ã§AWSå¼·ãƒ¡ãƒ³ã®åŒåƒšã«ç›¸è«‡ã—ã¦ã¿ãŸã¨ã“ã‚ã€<a href="https://serverless.com/framework/">Serverless Framework</a>ã£ã¦ã®ãŒã„ã„å…·åˆã«æŠ½è±¡åŒ–ã—ã¦ãã‚Œã¦ã‚‹ã®ã§è©¦ã—ã«ä½¿ã£ã¦ã¿ã¦ã¯ï¼Ÿã¨åŠ©è¨€ã„ãŸã ã‘ãŸã€‚</p><h3 id="ä½¿ã£ã¦ã¿ãŸ">ä½¿ã£ã¦ã¿ãŸ</h3><p>äº‹å‰ã«NodeãŒå¿…è¦ãªã“ã¨ãã‚‰ã„ã€‚</p><pre><code class="powershell"># global install
$ npm install -g serverless

# installed version
$ serverless --version
Framework Core: 1.51.0
Plugin: 1.3.10
SDK: 2.1.0

# generate boilerplate
$ serverless create --template aws-python3
Serverless: Generating boilerplate...
 _______                             __
|   _   .-----.----.--.--.-----.----|  .-----.-----.-----.
|   |___|  -__|   _|  |  |  -__|   _|  |  -__|__ --|__ --|
|____   |_____|__|  \___/|_____|__| |__|_____|_____|_____|
|   |   |             The Serverless Application Framework
|       |                           serverless.com, v1.51.0
 -------'

Serverless: Successfully generated boilerplate for template: "aws-python3"
Serverless: NOTE: Please update the "service" property in serverless.yml with your service name
</code></pre><p>ã“ã‚Œã§ç”Ÿæˆã•ã‚ŒãŸé–¢æ•°ã«å‡¦ç†ã‚’æ›¸ãã ã‘ã€‚ã‚ï½ã‚‰ã‹ã‚“ãŸã‚“ğŸ˜</p><p>ãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚è¶…ç°¡å˜ãªã®ã§ã€ã“ã‚Œãªã‚‰CDã«çµ„ã¿è¾¼ã‚€ã®ã‚‚æ¥½ãã†ã€‚</p><pre><code class="powershell"># deploy
serverless deploy -v

# deploy to specific stage
serverless deploy -v --stage dev
</code></pre><h3 id="cloudfrontã‚’æ·»ãˆã¦">CloudFrontã‚’æ·»ãˆã¦</h3><p>ä»Šå›ã®ä»•äº‹ã§ã¯ã¡ã‚‡ã£ã¨ç‰¹æ®Šãªäº‹æƒ…ã§CloudFrontã‚’çµŒç”±ã—ã¦Lambdaã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã€‚</p><p>ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ãˆã°ã‹ã‚“ãŸã‚“ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚</p><p><a href="https://github.com/Droplr/serverless-api-cloudfront">Droplr/serverless-api-cloudfront: Serverless Plugin - CloudFront distribution in front of your API Gateway</a></p><p>ãŒã€ã‹ã‚“ãŸã‚“ã«è¨˜è¿°ã§ãã‚‹ï¼ã‹ã‚“ãŸã‚“ãªå†…å®¹ã—ã‹ã„ã˜ã‚Œãªã„ã€ã®ãŸã‚ç‰‡æ‰‹è½ã¡ãªç‚¹ãŒå¤šã‹ã£ãŸã€‚è«¸ã€…ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æŒ‡å®šãŒã§ããªãã¦ç´°ã‹ãªæŒ‡å®šã‚’ã™ã‚‹å ´åˆã¯çµå±€<code>resources</code>ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è‡ªåŠ›ã§CloudFormationã‚’æ›¸ãã“ã¨ã«ãªã£ãŸã€‚</p><p>ä»¥ä¸‹ã¯resourceã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚µãƒ³ãƒ—ãƒ«ã€‚<code>DomainName</code>ã®è§£æ±ºã¯ä»¥ä¸‹ã®Stackoverflowã‹ã‚‰ãƒ’ãƒ³ãƒˆã‚’å¾—ãŸã€‚</p><p><a href="https://stackoverflow.com/questions/50931730/deploying-lambda-api-gateway-cloudfront-through-serverless-framework-at-a-ti">amazon web services - Deploying Lambda + API-gateway + CloudFront through serverless framework at a time - Stack Overflow</a></p><pre><code class="yaml">resources:
  Resources:
    LambdaDistribution:
      Type: AWS::CloudFront::Distribution
      Properties:
        DistributionConfig:
          Enabled: true
          Comment: "managed by serverless framewrok"
          HttpVersion: http2
          PriceClass: PriceClass_All
          Origins:
            - Id: ApiGateway
              DomainName: !Join
                - "."
                - - !Ref ApiGatewayRestApi
                  - execute-api
                  - !Ref AWS::Region
                  - amazonaws.com
              OriginPath: /
              CustomOriginConfig:
                HTTPPort: 80
                HTTPSPort: 443
                OriginProtocolPolicy: https-only
                OriginReadTimeout: 10
                OriginSSLProtocols:
                  - "SSLv3"
                  - "TLSv1"
                  - "TLSv1.1"
                  - "TLSv1.2"
          DefaultCacheBehavior:
            AllowedMethods:
              - HEAD
              - DELETE
              - POST
              - GET
              - OPTIONS
              - PUT
              - PATCH
            Compress: false
            DefaultTTL: 0
            MaxTTL: 0
            MinTTL: 0
            ForwardedValues:
              Cookies:
                Forward: none
              Headers:
                - x-api-key
              QueryString: false
            TargetOriginId: ApiGateway
            ViewerProtocolPolicy: redirect-to-https
</code></pre><p>ã¡ãªã¿ã«Lambda@Edgeã«ã¯ã¾ã å¯¾å¿œã—ã¦ã„ãªã„ã¿ãŸã„ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®åˆ©ç”¨ãŒå¿…é ˆã¨ãªã£ã¦ã„ã‚‹æ§˜å­ã€‚</p><p><a href="https://github.com/serverless/serverless/issues/3944">Support for Lambda@Edge Â· Issue #3944 Â· serverless/serverless</a></p><h3 id="æ„Ÿæƒ³">æ„Ÿæƒ³</h3><p>AWSã ã‘ã«ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³ã›ãšServeless Computingã®é–‹ç™ºãŒã§ãã‚‹ã‚ˆãƒ¼ãªæŠ½è±¡åŒ–å±¤ã‚’æä¾›ã™ã‚‹ã‚ˆã†ãªCLIã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚</p><p>èª•ç”Ÿã¯æ•°å¹´å‰ã§ã¾ã ã¾ã æ–°ã—ç›®ã®ãŸã‚ã€webä¸Šã«ã¯æ–°æ—§ã®æƒ…å ±ãŒç‰çŸ³æ··äº¤ã®çŠ¶æ…‹ã§ã‚ã‚‹ã‹ã‚‰ã—ã¦ã€ç´°ã‹ãªYAMLã®è¨˜è¿°å†…å®¹ã®ç¢ºèªãªã‚“ã‹ã¯<a href="https://serverless.com/framework/docs/">Serverless Framework Documentation</a>ã‚’å‚è€ƒã«ã—ã€å¤§ã¾ã‹ãªæ›¸ãæ–¹ã¯ãã®ã¸ã‚“ã®ãƒ–ãƒ­ã‚°ãªã©ã‹ã‚‰å¼•ã£ã“æŠœã„ã¦ãã‚‹ã®ãŒè‰¯ã„ã¨æ€ã‚ã‚Œã‚‹ã€‚</p><p>ã¾ã 1ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§ã—ã‹ä½¿ã£ã¦ãªã„ã‘ã©ã€ã„ã„æ„Ÿè§¦ã‚’å¾—ãŸã€‚YAMLã®è¨˜è¿°å†…å®¹ã¯ã€AWSã®å ´åˆã§ã„ã†ã¨resourcesã¯ã¾ã‚“ã¾CloudFormationãªã®ã§ã€ãã®ã¸ã‚“ã®çŸ¥è­˜ãŒã‚ã‚Œã°ä½¿ã„ã“ãªã›ãã†ã€‚SaaSã®ã‚„ã¤ã¯ã¾ã ä½¿ã£ã¦ãªã„ã®ã§æ„Ÿè§¦ãªã—ã€‚</p><h3 id="ãŠã¾ã‘-slsã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰å">ãŠã¾ã‘: <code>sls</code>ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰å</h3><p>ã°ã‹ã¿ãŸã„ãªè©±ãªã‚“ã‚„ã‘ã©ã€Serverless Frameworkã®çŸ­ç¸®å½¢ã‚³ãƒãƒ³ãƒ‰<code>sls</code>ã¯PowerShellã§è¨€ã†ã¨ã“ã‚ã®<code>Select-String</code>ã‚³ãƒãƒ³ãƒ‰ãƒ¬ãƒƒãƒˆã«ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã•ã‚Œã¦ã‚‹ã®ã§ä½¿ãˆã­ãˆï½—</p><p>ã§ã¯ã‚¢ãƒ‡ãƒ¥ãƒ¼ğŸ˜˜</p>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags/aws">aws</a>
    
    <a href="/tags/lambda">lambda</a>
    
    <a href="/tags/serverless">serverless</a>
    
</div>


    <div id="prev-next">
        
        <a href="/posts/2019-09-22-limitaion-of-remove-certificates">&laquo; 2019-09-22 ALBã®Listenerã‹ã‚‰è¨¼æ˜æ›¸ã‚’å‰Šé™¤ã™ã‚‹ã¨ãã®åˆ¶é™</a>
        
        
        <a class="right" href="/posts/2019-08-11-test-lambda-with-pwsh">2019-08-11 AWS Lambdaã‚’Powershellã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã™ã‚‹ &raquo;</a>
        
    </div>

    


</div>

            </div>
        </div>
    </div>
    <footer>Copyright &copy; 2019-2023 krymtkts
        <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/js/bootstrap.bundle.min.js" integrity="sha512-9GacT4119eY3AcosfWtHMsT5JyZudrexyEVzTBWV3viP/YfB9e2pEy3N7WXL3SV6ASXpTU0vzzSxsbfsuUH4sQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="/js/highlight.pack.js" type="application/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>


</body>
</html>
